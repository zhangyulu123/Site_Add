<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv = "X-UA-Compatible" content = "IE = edge" charset = "UTF-8"/> 
		<title>SiteAdd</title>
		<link rel = "stylesheet" href = "../src/main/webapp/pages/css/wanma.css"/>
		<link rel = "stylesheet" href = "../src/main/webapp/tools/easyui/themes/default/easyui.css"/>
		<link rel = "stylesheet" href = "../src/main/webapp/tools/easyui/themes/icon.css"/>
		
		<script type = "text/javascript" src = "../src/main/webapp/tools/tssJS/tssJS.all.js"></script>
		
		<script type = "text/javascript" src = "../src/main/webapp/tools/easyui/jquery.min.js"></script>
		<script type = "text/javascript" src = "../src/main/webapp/tools/easyui/jquery.easyui.min.js"></script>
		<script type = "text/javascript" src = "../src/main/webapp/tools/easyui/easyui-lang-zh_CN.js"></script>
		
		<script type = "text/javascript" src = "../src/main/webapp/tools/echarts/echarts-all-2.1.10.js"></script>
		<script type = "text/javascript" src = "../src/main/webapp/more/bi_template/echart.js"></script>
		<script type = "text/javascript" src = "../src/main/webapp/more/bi_template/common.js"></script>
		<script type = "text/javascript" src = "../src/main/webapp/pages/js/common.js"></script>
		<style type = "text/css">
			html, body {
				height: 100%;
			}
			
			#save1, #save2, #save3 {
				float: right;
			}
		</style>
		<script type = "text/javascript">
			var data;
			var center_to_org = {}, orgid = {}, monthid = {};//下拉框数据引用，同时标记分拨id
			var params = {"param1": "2016-4-13", "param2": "-1", "param3": "-1"};
			
			$(function(){
				
				var DATA_URL = "http://10.9.45.64:8080/tss/data/json/2212";
				var method = "POST";
				
				tssJS.ajax({
					url: DATA_URL,
					params: params,
					method: method,
					type: "json",
					waiting: true,
					ondata: function(){
						data =  this.getResponseJSON();
						basicObj(data);
						combosel();
						monsel();
						showCanvas(data);
						showGrid(data);
					}
				});
			});
			
			
						
			//完成率计算
			function rate_cal(add, target){

				if((target != 0) && (target != null) && (add != null)){
					return  Math.round(add/target*10000)/100; //保留两位小数
				}else{
					return ;	
				}
			};
			
			function basicObj(data){
				//分公司、分拨id构造，用于层级关系
				var orglist = [], centerlist = [], monthlist = [];
				var centerid = {}; 
				var s = 1, t = 1;
				
				
				$.each(data, function(i, item){
					var org = item.org_name,  month = item.imonth;
					if(!orglist.contains(org)){
						orglist.push(org);
						orgid[org] = s;
						center_to_org[org] = {};
						s++;
					};
					
					//对日期定义id主要用于定义不同月份field名字
					if(!monthlist.contains(month)){  
						monthlist.push(month);
						monthid[month] = t;
						t++;
					}  
				});
		

				var len = (orglist.length).toString().length;
				
				$.each(data, function(i, item){
					var org = item.org_name, center = item.center;
					var pid = orgid[org], id = 0;
					if(!center_to_org.hasOwnProperty(org)){
						id = Math.pow(10, len)*pid+1;
						center_to_org[org] = {};
						center_to_org[org][center] = id;
					
					}else{
						if(!center_to_org[org].hasOwnProperty(center)){
							id = Object.getOwnPropertyNames(center_to_org[org]).length + 1;
							center_to_org[org][center] = id;
						};
					}
				});
					
			}
		
				
		function monsel(){
			$("#mon").datebox({
			onShowPanel: function () {
			span.trigger('click'); 
			if (!tds) setTimeout(function () {
				tds = p.find('div.calendar-menu-month-inner td');
				tds.click(function (e) {
					e.stopPropagation(); 
					var year = /\d{4}/.exec(span.html())[0]
					, month = parseInt($(this).attr('abbr'), 10); 
					$('#mon').datebox('hidePanel')
					.datebox('setValue', year+'-'+(month<10?('0'+month):month)); 
				});
			}, 0)
            },
            parser: function (s) {
                if (!s) return new Date();
                var arr = s.split('-');
                return new Date(parseInt(arr[0], 10), parseInt(arr[1], 10)-1);
            },
            formatter: function (d) { 
				var mon = d.getMonth()+1;
				return d.getFullYear()+'-'+(mon<10?('0'+mon):mon); 
				}
			});
			
			var p = $('#mon').datebox('panel'), 
            tds = false, 
            span = p.find('span.calendar-text'); 
			
			monsel_init()
		}
		
		function to_getime(date){
			var s = date.split("-");
			var y = parseInt(s[0]);
			var m = parseInt(s[1]) -1;
			return new Date(y, m).getTime();
		}
		
		function monsel_init(){
			var dt = params.param1.split("-");
			var y = dt[0];
			var m = parseInt(dt[1]);
			$("#mon").datebox("setValue", y+"-"+(m<10?('0'+m):m));
		}
		
		function  combosel(){
			var orglist = [], centerlist = [];
			if(params.param2 == '-1'){
				orglist = [{"id": "-1", "org": "全网", "selected": true}];
				centerlist = [{"id": "-1", "center": "全部", "selected": true}];
				for(var key1 in orgid){
					orglist.push({"id": orgid[key1], "org": key1});
				}	
			}else{
				orglist = [{"id": orgid[params.param2], "org": params.param2, selected: "true"}];
				if(params.param3 == "-1"){
					centerlist = [{"id": "全部", "center": "全部", "selected": true}];
				}
				
				for(var key in center_to_org[params.param2]){
					if(key != params.param3){
						centerlist.push({"id": key, "center": key});
					}else{
						centerlist.push({"id": key, "center": key, "selected": true});
					}
				};
			};
				
			$("#org").combobox({
				valueField: "id",
				textField: "org",	
				data: orglist,
				onSelect: function(rec){
					var centerlist = [{"id": "全部", "center": "全部", "selected": true}];
					if(rec.id != "-1"){
						for(var key in center_to_org[rec.org]){
							centerlist.push({"id": key, "center": key});
						}
					};
					$("#center").combobox("loadData", centerlist);
				}
			});
			
			$("#center").combobox({
				valueField: "id",
				textField: "center",
				data: centerlist
			});
				
		}
	
		
		
		//数量统计	
		function amount_Analysis(data){
			var dataObj = {};
			var org = $("#org").combobox("getText");
			var center = $("#center").combobox("getText");
			if(org == "全网"){
				$.each(data, function(i, item){
				var month = item.imonth;
				if(!dataObj.hasOwnProperty(month)){
					dataObj[month] = {};
					dataObj[month]["site"] = item.site;
					dataObj[month]["cbq"] = item.cbq;
					dataObj[month]["store"] = item.store;
				}else{
					dataObj[month]["site"] += item.site;
					dataObj[month]["cbq"] += item.cbq;
					dataObj[month]["store"] += item.store
				}
				});	
			}else{
				if(center == "全部"){
					$.each(data, function(i, item){
					var month = item.imonth;
					if(item.org_name == org){
						if(!dataObj.hasOwnProperty(month)){
						dataObj[month] = {};
						dataObj[month]["site"] = item.site;
						dataObj[month]["cbq"] = item.cbq;
						dataObj[month]["store"] = item.store;
						}else{
							dataObj[month]["site"] += item.site;
							dataObj[month]["cbq"] += item.cbq;
							dataObj[month]["store"] += item.store
						}
					}
					});	
				}else{
					$.each(data, function(i, item){
						var month = item.imonth;
						if(item.org_name == org && item.center == center){
							if(!dataObj.hasOwnProperty(month)){
							dataObj[month] = {};
							dataObj[month]["site"] = item.site;
							dataObj[month]["cbq"] = item.cbq;
							dataObj[month]["store"] = item.store;
							dataObj[month]["site_a"] = item.site_a;
							}
						}
					});	
				};
			};
			
			var labels = [], data_s = [], data_c = [], data_a = [];
			for(var m in dataObj){
				data_s.push(dataObj[m]["site"]);
				data_c.push(dataObj[m]["cbq"]);
				data_a.push(dataObj[m]["store"]);
				labels.push(m);
			};
			return axisLimit(labels, data_a, data_s, data_c);
		}
		
		//完成率统计
		function rate_Analysis(data){
			var dataObj = {};
			var org = $("#org").combobox("getText");
			var center = $("#center").combobox("getText");
			if(org == "全网"){
				$.each(data, function(i, item){
					var month = item.imonth;
					if(!dataObj.hasOwnProperty(month)){
						dataObj[month] = {};
						dataObj[month]["site_a"] = item.site_a;
						dataObj[month]["cbq_a"] = item.cbq_a;
						dataObj[month]["store_a"] = item.store_a;
						dataObj[month]["site_t"] = item.site_t;
						dataObj[month]["cbq_t"] = item.cbq_t;
						dataObj[month]["store_t"] = item.store_t;
					}else{
						dataObj[month]["site_a"] += item.site_a;
						dataObj[month]["cbq_a"] += item.cbq_a;
						dataObj[month]["store_a"] += item.store_a;
						dataObj[month]["site_t"] += item.site_t;
						dataObj[month]["cbq_t"] += item.cbq_t;
						dataObj[month]["store_t"] += item.store_t;
					}
				});
			}else{
				if(center == "全部"){
					$.each(data, function(i, item){
						var month = item.imonth;
						if(item.org_name == org){
							if(!dataObj.hasOwnProperty(month)){
							dataObj[month] = {};
							dataObj[month]["site_a"] = item.site_a;
							dataObj[month]["cbq_a"] = item.cbq_a;
							dataObj[month]["store_a"] = item.store_a;
							dataObj[month]["site_t"] = item.site_t;
							dataObj[month]["cbq_t"] = item.cbq_t;
							dataObj[month]["store_t"] = item.store_t;
							}else{
								dataObj[month]["site_a"] += item.site_a;
								dataObj[month]["cbq_a"] += item.cbq_a;
								dataObj[month]["store_a"] += item.store_a;
								dataObj[month]["site_t"] += item.site_t;
								dataObj[month]["cbq_t"] += item.cbq_t;
								dataObj[month]["store_t"] += item.store_t;
							}
						}
					});
				}else{
					$.each(data, function(i, item){
						var month = item.imonth;
						if(item.org_name == org && item.center == center){
							if(!dataObj.hasOwnProperty(month)){
								dataObj[month] = {};
								dataObj[month]["site_a"] = item.site_a;
								dataObj[month]["cbq_a"] = item.cbq_a;
								dataObj[month]["store_a"] = item.store_a;
								dataObj[month]["site_t"] = item.site_t;
								dataObj[month]["cbq_t"] = item.cbq_t;
								dataObj[month]["store_t"] = item.store_t;
							};
						};
					});
						
				}
			}
			
			var data_s = [], data_c = [], data_a = [], labels = [];
			for(var n in dataObj){
				var rate_s = rate_cal(dataObj[n]["site_a"], dataObj[n]["site_t"]);
				var rate_c = rate_cal(dataObj[n]["cbq_a"], dataObj[n]["cbq_t"]);
				var rate_a = rate_cal(dataObj[n]["store_a"], dataObj[n]["store_t"]);
				data_s.push((rate_s==undefined)?0.01:rate_s);
				data_c.push((rate_c==undefined)?0.01:rate_c);
				data_a.push((rate_a==undefined)?0.01:rate_a);
				labels.push(n);
			};
			
			return axisLimit(labels, data_a, data_s, data_c);
			
		}
		
		//控制只显示最近12个月数据
		function axisLimit(labels, data_a, data_s, data_c){
			var len = labels.length;
			var new_labels = [], new_data_s = [], new_data_a = [], new_data_c = [];
			if(len < 12){
				new_labels = labels;
				new_data_s = data_s;
				new_data_a = data_a;
				new_data_c = data_c;
				for(var i = 0; i < 12- len; i++){
					new_labels.push("");
				}
			}else{
				for(var i = len-12; i < len; i++){
					new_labels.push(labels[i]);
					new_data_a.push(data_a[i]);
					new_data_s.push(data_s[i]);
					new_data_c.push(data_c[i]);
					
				}
			};
			return [new_labels, new_data_a, new_data_s, new_data_c];
		}

		function showCanvas(data){
			
			var func1 = amount_Analysis(data);
			var func2 = rate_Analysis(data);
			
			var myChart1 = echarts.init(document.getElementById("canvas1"));
			var option1 = {
				color: ["#D14A61", "#FD9C35", "#61A0A8"],
				title: {
					text: ($("#center").combobox("getText")=="全部")?$("#org").combobox("getText")+"门店数量统计":$("#center").combobox("getText")+"门店数量统计" 
				},
				xAxis: [{
					type: "category",
					axisLine: {
						lineStyle: {
							color: "#rgba(0,0,0,0.6)",
							width: 2
						}
					},
					data: func1[0]	
				}],
				yAxis: [{
					type: "value",
					splitNumber: 6,
					axisLine: {
						lineStyle: {
						color: "rgba(0,0,0,0.6)",
						width: 1
						}
					}

				}],
				tooltip: {
					trigger: "axis",
					axisPointer: {
						type: "shadow"
					}
				},
				legend: {
					show: true,
					data: ["门店", "网点", "承包区"]
				},
				series: [{
					name: "门店",
					type: "bar",
					barGap: 0,
					data: func1[1]
				},{
					name: "网点",
					type: "bar",
					barGap: 0,
					data: func1[2]
				},{
					name: "承包区",
					type: "bar",
					barGap: 0,
					data: func1[3]
				}]
			};
			
			myChart1.setOption(option1);
			
			var myChart2 = echarts.init(document.getElementById("canvas2"));
			
			//完成率100%基线
			var basic = new Array(12);
			for(var i = 0; i < basic.length; i++){
				basic[i] = 100;
			};
			
			var option2 = {
				color: ["#D14A61", "#FD9C35", "#61A0A8"],
				title: {
					text: ($("#center").combobox("getText")=="全部")?$("#org").combobox("getText")+"门店完成率统计":$("#center").combobox("getText")+"门店完成率统计"
				},
				xAxis: [{
					type: "category",
					axisLine: {
						lineStyle: {
							color: "#rgba(0,0,0,0.6)",
							width: 2
						}
					},
					data: func2[0]	
				}],
				yAxis: [{
					type: "value",
					splitNumber: 6,
					axisLabel : {
						formatter: "{value}%"
					},
					axisLine: {
						lineStyle: {
						color: "rgba(0,0,0,0.6)",
						width: 1
						}
					}
				}],
				tooltip: {
					trigger: "axis",
					axisPointer: {
						type: "shadow",
						
					}
				},
				legend: {
					show: true,
					data: ["门店", "网点", "承包区"]
				},
				series: [{
					name: "门店",
					type: "bar",
					barGap: 0,
					data: func2[1],
					markLine: {
						data: [[
						{name: '基线起点', value: 100, xAxis: 0, yAxis: 100},
						{name: '基线终点', xAxis: 700, yAxis: 100}
					]],
						itemStyle: {
							normal:{
								color: "rgba(0,0,0,1)",
								label: {
									formatter: "100%"
								}
							}	
						}
						
					}
				},{
					name: "网点",
					type: "bar",
					barGap: 0,
					data: func2[2]
				},{
					name: "承包区",
					type: "bar",
					barGap: 0,
					data: func2[3]
				}]
			}
			
			myChart2.setOption(option2);
			
			
		};
		
		//datagrid源数据校验，月份是够过大或过小
		function to_error(){
			var mon = $("#mon").datebox("getText");
			var temp = to_getime(mon);
			var countlist = []
			for(var key in monthid){
				countlist.push(to_getime(key))
			}
			var mx = Math.max.apply(null, countlist);
			var mn = Math.min.apply(null, countlist);
			if(temp<mn){
				alert("源数据不足");
				monsel_init();
				gridData(data)
			}else if(temp>mx){
				alert("选择月份不得大于查询月份");
				monsel_init();
				gridData(data)
			}
			
		}
		
		//datagrid展示数据获取
		function gridData(data){
			to_error();
			var mon = $("#mon").datebox("getText");
			var org = $("#org").combobox("getText");
			var center = $("#center").combobox("getText");
			var tip = 1;//标记是否需要展示集团列
			var dataObj = {};
			if(org == "全网"){
				$.each(data, function(i, item){
					if(item.imonth == mon){
						if(!dataObj.hasOwnProperty(item.org_name)){
							dataObj[item.org_name] = {};
							dataObj[item.org_name]["site"] = item.site;
							dataObj[item.org_name]["site_a"] = item.site_a;
							dataObj[item.org_name]["site_t"] = item.site_t;
							dataObj[item.org_name]["cbq"] = item.cbq;
							dataObj[item.org_name]["cbq_a"] = item.cbq_a;
							dataObj[item.org_name]["cbq_t"] = item.cbq_t;
							dataObj[item.org_name]["store"] = item.store;
							dataObj[item.org_name]["store_a"] = item.store_a;
							dataObj[item.org_name]["store_t"] = item.store_t;
							dataObj[item.org_name]["belong"] = item.organization;
						}else{
							dataObj[item.org_name]["site"] += item.site;
							dataObj[item.org_name]["site_a"] += item.site_a;
							dataObj[item.org_name]["site_t"] += item.site_t;
							dataObj[item.org_name]["cbq"] += item.cbq;
							dataObj[item.org_name]["cbq_a"] += item.cbq_a;
							dataObj[item.org_name]["cbq_t"] += item.cbq_t;
							dataObj[item.org_name]["store"] += item.store;
							dataObj[item.org_name]["store_a"] += item.store_a;
							dataObj[item.org_name]["store_t"] += item.store_t;
						}
					}
				});
			}else{
				tip = 0;
				$.each(data, function(i, item){
					if(item.imonth == mon && item.org_name == org){
						dataObj[item.center] = {};
						dataObj[item.center]["site"] = item.site;
						dataObj[item.center]["cbq"] = item.cbq;
						dataObj[item.center]["store"] = item.store;
						dataObj[item.center]["site_a"] = item.site_a;
						dataObj[item.center]["site_t"] = item.site_t;
						dataObj[item.center]["cbq_a"] = item.cbq_a;
						dataObj[item.center]["cbq_t"] = item.cbq_t;
						dataObj[item.center]["store_a"] = item.store_a;
						dataObj[item.center]["store_t"] = item.store_t;
					}
				})
			}
			
			//导出数据表头
			var amount_str = "", add_str = "", rate_str = "";
			if(tip){
				amount_str = "集团"+","+"分公司"+","+"网点"+","+"承包区"+","+"门店"+"\n";
				add_str = "集团"+","+"分公司"+","+"网点"+","+"承包区"+","+"门店"+"\n";
				rate_str = "集团"+","+"分公司"+","+"网点"+","+"承包区"+","+"门店"+"\n";
			}else{
				amount_str = "分拨"+","+"网点"+","+"承包区"+","+"门店"+"\n";
				add_str = "分拨"+","+"网点"+","+"承包区"+","+"门店"+"\n";
				rate_str = "分拨"+","+"网点"+","+"承包区"+","+"门店"+"\n";
			}
			
			
			var amount = [], add = [], rate = [];
			for(var key in dataObj){
				var r1 = rate_cal(dataObj[key]["site_a"], dataObj[key]["site_t"]);
				var r2 = rate_cal(dataObj[key]["cbq_a"], dataObj[key]["cbq_t"]);
				var r3 = rate_cal(dataObj[key]["store_a"], dataObj[key]["store_t"])
				if(dataObj[key].hasOwnProperty("belong")){
					amount.push({"belong": dataObj[key]["belong"], "org": key, "site": dataObj[key]["site"], "cbq": dataObj[key]["cbq"], "store": dataObj[key]["store"]});
					amount_str += dataObj[key]["belong"]+","+key+","+dataObj[key]["site"]+","+dataObj[key]["cbq"]+","+dataObj[key]["store"]+"\n";
					add.push({"belong": dataObj[key]["belong"], "org": key, "site": dataObj[key]["site_a"], "cbq": dataObj[key]["cbq_a"], "store": dataObj[key]["store_a"]});
					add_str += dataObj[key]["belong"]+","+key+","+dataObj[key]["site_a"]+","+dataObj[key]["cbq_a"]+","+dataObj[key]["store_a"]+"\n";
					rate.push({"belong": dataObj[key]["belong"], "org": key, "site": r1, "cbq": r2, "store": r3});
					rate_str += dataObj[key]["belong"]+","+key+","+r1+","+r2+","+r3+"\n";
				}else{
					amount_str = "分拨"+","+"网点"+","+"承包区"+","+"门店"+"\n";
					amount.push({"center": key, "site": dataObj[key]["site"], "cbq": dataObj[key]["cbq"], "store": dataObj[key]["store"]});
					amount_str += key+","+dataObj[key]["site"]+","+dataObj[key]["cbq"]+","+dataObj[key]["store"]+"\n";
					add.push({"center": key, "site": dataObj[key]["site_a"], "cbq": dataObj[key]["cbq_a"], "store": dataObj[key]["store_a"]});
					add_str += key+","+dataObj[key]["site_a"]+","+dataObj[key]["cbq_a"]+","+dataObj[key]["store_a"]+"\n";
					rate.push({"center": key, "site": r1, "cbq": r2, "store": r3});
					rate_str += key+","+r1+","+r2+","+r3+"\n";
				}	
			}
			
			return [amount, add, rate, tip, amount_str, add_str, rate_str];
		}
		
		//分公司多一行集团额列
		function gridCol(tip){
			var cols = [];
			if(tip){
				var wd = "20%"
				cols.push({field: "belong", title: "集团", width: wd, align: "center"})
				cols.push({field: "org", title: "分公司", width: wd, align: "center"})
			}else{
				var wd = "25%"
				cols.push({field: "center", title: "分拨", width: wd, align: "center"})
			};
			cols.push({field: "site", title: "网点", width: wd, align: "center"});
			cols.push({field: "cbq", title: "承包区", width: wd, align: "center"});
			cols.push({field: "store", title: "门店", width: wd, align: "center", order: "desc"});
			
			return cols;
		};
		
		
		function showGrid(data){
			var func = gridData(data);
			var tip = func[3];
			var cols = gridCol(tip);
			var mon = $("#mon").datebox("getText").replace("-", "");//用于下载文件名后缀
			var org = $("#org").combobox("getText");
			var center = $("#center").combobox("getText");
			var title1 = (org == "全网")?"全网各分公司门店数量明细":(org+"各分拨门店数量明细");
			var title2 = (org == "全网")?"全网各分公司门店新增明细":(org+"各分拨门店新增明细");
			var title3 = (org == "全网")?"全网各分公司门店完成率明细":(org+"各分拨门店完成率明细");
			
			$("#amount").datagrid({
				title: title1,
				columns: [cols],
				data: func[0],
				onLoadSuccess:function(data){
					mergeCellsByField("amount", "集团");
				}
			});
			
			$("#add").datagrid({
				title: title2,
				columns: [cols],
				data: func[1]
			});
			
			$("#rate").datagrid({
				title: title3,
				columns: [cols],
				data: func[2]
			});
			
		$('#save1').click(saveFile(eval("'"+title1+mon+"'"), func[4]));	
		$('#save2').click(saveFile(eval("'"+title2+mon+"'"), func[5]));
		$('#save3').click(saveFile(eval("'"+title3+mon+"'"), func[6]));
			
		};
		
		
		//导出数据
		function saveFile(filename, data){
			$(this)[0].download = filename+'.csv';
				this.href = "data:text/csv;charset=utf-8,\ufeff" + encodeURIComponent(data);
		}
		
		function mergeCellsByField(tableID,colList){

		   var ColArray = colList.split(",");
		   var tTable = $('#'+tableID);
		   var TableRowCnts=tTable.datagrid("getRows").length;
		   var tmpA;
		   for (j=0;j<=ColArray.length-1 ;j++ ) //列
		   //for (j=ColArray.length-1;j>=0 ;j-- )
		   {
			   //当循环至某新的列时，变量复位。
			   PerTxt="";
			   tmpA=1;


		   var PerTxt = "";
		   var CurTxt = "";
       //从第一行（表头为第0行）开始循环，循环至行尾(溢出一位)
       for (i=0;i<=TableRowCnts ;i++ )//行
       {
         var tempStr="";
           if (i==TableRowCnts)
           {
               CurTxt="";
           }
           else
           {
             
             for(var tempi=0;tempi<j;tempi++){
             tempStr = tempStr+tTable.datagrid("getRows")[i][ColArray[tempi]];
             }              
           }
           if (PerTxt==tempStr)
           {
               tmpA+=1;
           }
           else
           {
               tTable.datagrid('mergeCells',{
                   index:i-tmpA,
                   field:ColArray[j-1],
                   rowspan:tmpA,
                   colspan:null
               });
               tmpA=1;
           }
           PerTxt=tempStr;
       }
   }
}

/*		
		//合并单元格
		function mergeCell(tableid, col){
			var tTable = $("#"+tableid);
			var rows = tTable.datagrid("getRow").length;
			var count = 1;
			var curtxt = "";
			var reftxt = tTable.datagrid("getRows")[0][col];
			for(var i = 1; i <= rows; i++){
				if(i == rows){
					tTable.datagrid("mergeCells", { 
                    index: i - count,
                    field: col,
                    rowspan: count
					});
				}else{
					curtxt = tTable.datagrid("getRows")[i][col];
					if(reftxt == curtxt){
						count ++
					}else{
						tTable.datagrid("mergeCells", { 
						index: i - count,
						field: col,
						rowspan: count
						});
						count = 1;
						reftxt = tTable.datagrid("getRows")[i][col];
					}
				}
				
			}
		};
		
*/		
		function canvasClick(){
			showCanvas(data);
			var d = params.param1.split("-");
			var y = d[0];
			var m = parseInt(d[1]);
			$("#mon").datebox("setValue", y+"-"+(m<10?('0'+m):m));
			showGrid(data);
		}
			
		</script>
	<head>
	<body>
		<div id = "main" class = "easyui-layout" fit = "true">
			<div data-options = "region: 'center'" style = "width: 70%">
				<div class = "easyui-layout" fit = "true">
					<div data-options = "region: 'north'" style = "height: 10%">
						<span>分公司：</span>
						<input  class = "easyui-combox" name = "org" id = "org" style = "width: 100px"/>
						<span>分拨：</span>
						<input  class = "easyui-combox" name = "center" id = "center" style = "width: 100px"/>
						<input 	class = "easyui-linkbutton" id = "sbt" style = "width: 50px; height: 25px" value = "确定" onclick = "canvasClick()"/>
					</div>
					<div id = "canvas1" data-options = "region: 'center'" style = "height: 45%"></div>
					<div id = "canvas2" data-options = "region: 'south'" style = "height: 45%"></div>
				</div>
			</div>
			<div data-options = "region: 'east'" style = "width: 30%">
				<div>
					<span>查询条件:</span>
					<input class = "easyui-datebox" id = "mon" name = "mon" style = "width: 100px"/>&nbsp;&nbsp;
					<input 	class = "easyui-linkbutton" id = "sbt1" style = "width: 50px; height: 25px" value = "确定" onclick = "showGrid(data)"/>
				</div>
				<div class = "easyui-layout" fit = "true">
					<div data-options = "region: 'north'" style = "height: 40%">
						<a id="save1" class="easyui-linkbutton" data-options="iconCls:'icon-save'"></a>
						<table id = "amount" data-options = ""></table>
					</div>
					<div data-options = "region: 'center'" style = "height: 30%">
						<a id="save2" class="easyui-linkbutton" data-options="iconCls:'icon-save'"></a>
						<table  id = "add" ></table>
					</div>
					<div data-options = "region: 'south'" style = "height: 30%">
						<a id="save3" class="easyui-linkbutton" data-options="iconCls:'icon-save'"></a>
						<table  id = "rate"></table>
					</div>
				</div>
				
			</div>
		</div>
	</body>
</html>